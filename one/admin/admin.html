<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - 个人网站</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/root.css">
    <link rel="stylesheet" href="css/admin-style.css">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="../wangzhan/static/img/logo.png" alt="Logo">
                    <h2>管理后台</h2>
                </div>
                <button class="sidebar-toggle" id="sidebar-toggle" aria-label="切换侧边栏">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item">
                    <a href="#dashboard" class="menu-link active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>仪表盘</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#articles" class="menu-link" data-page="articles">
                        <i class="fas fa-file-alt"></i>
                        <span>文章管理</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#photos" class="menu-link" data-page="photos">
                        <i class="fas fa-images"></i>
                        <span>相册管理</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#messages" class="menu-link" data-page="messages">
                        <i class="fas fa-comments"></i>
                        <span>留言管理</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#profile" class="menu-link" data-page="profile">
                        <i class="fas fa-user"></i>
                        <span>个人信息</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#settings" class="menu-link" data-page="settings">
                        <i class="fas fa-cog"></i>
                        <span>系统设置</span>
                    </a>
                </li>
            </ul>

        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部导航 -->
            <header class="header">
                <button class="mobile-toggle" id="mobile-toggle" aria-label="切换移动端侧边栏">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="page-title">仪表盘</h1>
                <div class="header-actions">
                    <div class="user-menu">
                        <button class="user-menu-btn" id="user-menu-btn" aria-label="用户菜单" aria-expanded="false">
                            <img src="../wangzhan/static/img/touxiang/tx2.jpeg" alt="用户头像" class="user-avatar-sm">
                            <span>管理员</span>
                        </button>
                        <ul class="dropdown-menu" id="user-dropdown">
                            <li>
                                <a href="#profile" class="dropdown-item" data-page="profile">
                                    <i class="fas fa-user"></i>
                                    <span>个人资料</span>
                                </a>
                            </li>
                            <li>
                                <a href="#settings" class="dropdown-item" data-page="settings">
                                    <i class="fas fa-cog"></i>
                                    <span>设置</span>
                                </a>
                            </li>
                            <li class="dropdown-divider"></li>
                            <li>
                                <a href="#" class="dropdown-item" id="header-logout">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>退出登录</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <button class="theme-toggle" id="theme-toggle" aria-label="切换主题">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </header>

            <!-- 页面内容容器 -->
            <div class="page-container">
                <!-- 初始化错误提示 -->
                <div class="error-alert" id="init-error" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <div class="error-alert-content">
                        <h3>系统初始化失败</h3>
                        <p>无法加载必要的系统组件，请刷新页面重试</p>
                        <p class="text-muted small">错误: 核心库加载超时</p>
                        <button class="btn btn-primary" onclick="location.reload()">刷新页面</button>
                    </div>
                </div>

                <!-- 仪表盘页面 -->
                <section class="page-content active" id="dashboard-page" aria-label="仪表盘页面">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon articles">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="articles-count">0</h3>
                                <p>文章总数</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon photos">
                                <i class="fas fa-images"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="photos-count">0</h3>
                                <p>相册总数</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon messages">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="messages-count">0</h3>
                                <p>留言总数</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon views">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="views-count">0</h3>
                                <p>总浏览量</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid-layout">
                        <div class="card">
                            <div class="card-header">
                                <h4>最新文章</h4>
                                <a href="#articles" class="btn btn-sm btn-primary" data-page="articles">
                                    <i class="fas fa-arrow-right"></i> 查看全部
                                </a>
                            </div>
                            <div class="card-body">
                                <ul class="recent-list" id="recent-articles">
                                    <!-- 动态加载 -->
                                </ul>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>最新留言</h4>
                                <a href="#messages" class="btn btn-sm btn-primary" data-page="messages">
                                    <i class="fas fa-arrow-right"></i> 查看全部
                                </a>
                            </div>
                            <div class="card-body">
                                <ul class="recent-list" id="recent-messages">
                                    <!-- 动态加载 -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 文章管理页面 -->
                <section class="page-content" id="articles-page" aria-label="文章管理页面">
                    <div class="page-header">
                        <h2>文章管理</h2>
                        <button class="btn btn-primary" id="add-article-btn" aria-label="添加新文章">
                            <i class="fas fa-plus"></i> 添加文章
                        </button>
                    </div>
                    <div class="filters">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="搜索文章...">
                        </div>
                        <div class="form-group">
                            <select class="form-control">
                                <option value="">所有分类</option>
                                <option value="1">技术</option>
                                <option value="2">生活</option>
                                <option value="3">旅行</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select class="form-control">
                                <option value="">所有状态</option>
                                <option value="published">已发布</option>
                                <option value="draft">草稿</option>
                            </select>
                        </div>
                    </div>
                    <div class="card">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>标题</th>
                                        <th>分类</th>
                                        <th>发布时间</th>
                                        <th>状态</th>
                                        <th>浏览量</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 相册管理页面 -->
                <section class="page-content" id="photos-page" aria-label="相册管理页面">
                    <div class="page-header">
                        <h2>相册管理</h2>
                        <button class="btn btn-primary" id="add-photo-btn" aria-label="添加新照片">
                            <i class="fas fa-plus"></i> 添加照片
                        </button>
                    </div>
                    <div class="filters">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="搜索相册...">
                        </div>
                        <div class="form-group">
                            <select class="form-control">
                                <option value="">所有分类</option>
                                <option value="1">风景</option>
                                <option value="2">人像</option>
                                <option value="3">纪实</option>
                            </select>
                        </div>
                    </div>
                    <div class="card">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>标题</th>
                                        <th>分类</th>
                                        <th>上传时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 留言管理页面 -->
                <section class="page-content" id="messages-page" aria-label="留言管理页面">
                    <div class="page-header">
                        <h2>留言管理</h2>
                    </div>
                    <div class="filters">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="搜索留言...">
                        </div>
                        <div class="form-group">
                            <select class="form-control">
                                <option value="">所有状态</option>
                                <option value="read">已读</option>
                                <option value="unread">未读</option>
                            </select>
                        </div>
                    </div>
                    <div class="card">
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>邮箱</th>
                                        <th>留言时间</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 个人信息页面 -->
                <section class="page-content" id="profile-page" aria-label="个人信息页面">
                    <div class="page-header">
                        <h2>个人信息</h2>
                        <button class="btn btn-primary" id="edit-profile-btn" aria-label="编辑个人信息">
                            <i class="fas fa-edit"></i> 编辑信息
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="grid-layout">
                                <div>
                                    <h3>基本信息</h3>
                                    <p><strong>姓名：</strong> 管理员</p>
                                    <p><strong>邮箱：</strong> admin@example.com</p>
                                    <p><strong>加入时间：</strong> 2023-01-01</p>
                                </div>
                                <div>
                                    <img src="../wangzhan/static/img/touxiang/tx2.jpeg" alt="用户头像" class="user-avatar" style="margin: 0 auto; display: block;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统设置页面 -->
                <section class="page-content" id="settings-page" aria-label="系统设置页面">
                    <div class="page-header">
                        <h2>系统设置</h2>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <form id="settings-form" aria-label="系统设置表单">
                                <div class="form-group">
                                    <label for="site-title">网站标题</label>
                                    <input type="text" class="form-control" id="site-title" value="个人网站">
                                </div>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label for="site-description">网站描述</label>
                                    <textarea class="form-control" id="site-description" rows="3">这是我的个人网站</textarea>
                                </div>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label for="site-theme">主题设置</label>
                                    <select class="form-control" id="site-theme">
                                        <option value="light">浅色模式</option>
                                        <option value="dark">深色模式</option>
                                        <option value="auto">自动切换</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary" style="margin-top: 1.5rem;">
                                    <i class="fas fa-save"></i> 保存设置
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 添加文章模态框 -->
    <div class="modal-overlay" id="article-modal">
        <div class="modal">
            <div class="modal-header">
                <h4>添加文章</h4>
                <button class="modal-close" data-modal="article-modal" aria-label="关闭模态框">&times;</button>
            </div>
            <div class="modal-body">
                <form id="article-form" aria-label="添加文章表单">
                    <div class="form-group">
                        <label for="article-title">标题</label>
                        <input type="text" class="form-control" id="article-title" required>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="article-excerpt">摘要</label>
                        <textarea class="form-control" id="article-excerpt" rows="3"></textarea>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="article-content">内容</label>
                        <textarea class="form-control" id="article-content" rows="10" required></textarea>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="article-category">分类</label>
                        <select class="form-control" id="article-category" required>
                            <option value="">选择分类</option>
                            <option value="1">技术</option>
                            <option value="2">生活</option>
                            <option value="3">旅行</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="article-tags">标签</label>
                        <input type="text" class="form-control" id="article-tags" placeholder="标签1, 标签2, 标签3">
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="article-cover">封面图片</label>
                        <input type="text" class="form-control" id="article-cover" placeholder="图片URL">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close" data-modal="article-modal">取消</button>
                <button class="btn btn-primary" id="save-article">保存</button>
            </div>
        </div>
    </div>

    <!-- 添加照片模态框 -->
    <div class="modal-overlay" id="photo-modal">
        <div class="modal">
            <div class="modal-header">
                <h4>添加照片</h4>
                <button class="modal-close" data-modal="photo-modal" aria-label="关闭模态框">&times;</button>
            </div>
            <div class="modal-body">
                <form id="photo-form" aria-label="添加照片表单">
                    <div class="form-group">
                        <label for="photo-title">标题</label>
                        <input type="text" class="form-control" id="photo-title" required>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="photo-description">描述</label>
                        <textarea class="form-control" id="photo-description" rows="3"></textarea>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="photo-url">图片URL</label>
                        <input type="text" class="form-control" id="photo-url" required>
                    </div>
                    <div class="form-group" style="margin-top: 1rem;">
                        <label for="photo-category">分类</label>
                        <select class="form-control" id="photo-category" required>
                            <option value="">选择分类</option>
                            <option value="1">风景</option>
                            <option value="2">人像</option>
                            <option value="3">纪实</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close" data-modal="photo-modal">取消</button>
                <button class="btn btn-primary" id="save-photo">保存</button>
            </div>
        </div>
    </div>

    <!-- 留言详情模态框 -->
    <div class="modal-overlay" id="message-modal">
        <div class="modal">
            <div class="modal-header">
                <h4>留言详情</h4>
                <button class="modal-close" data-modal="message-modal" aria-label="关闭模态框">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>姓名</label>
                    <p id="message-name">-</p>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>邮箱</label>
                    <p id="message-email">-</p>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>内容</label>
                    <p id="message-content">-</p>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>IP地址</label>
                    <p id="message-ip">-</p>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>留言时间</label>
                    <p id="message-time">-</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close" data-modal="message-modal">关闭</button>
            </div>
        </div>
    </div>

    <!-- 引入AdminCommon类 -->
    <script src="js/admin-common.js"></script>
    <script>
        // 初始化AdminCommon实例
        const adminCommon = new AdminCommon();
        
        // DOM元素
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const mobileToggle = document.getElementById('mobile-toggle');
        const userMenuBtn = document.getElementById('user-menu-btn');
        const userDropdown = document.getElementById('user-dropdown');
        const pageTitle = document.getElementById('page-title');
        const menuLinks = document.querySelectorAll('.menu-link, .dropdown-item[data-page]');
        const pageContents = document.querySelectorAll('.page-content');
        const initError = document.getElementById('init-error');
        const themeToggle = document.getElementById('theme-toggle');
        
        // 模态框相关
        const modals = document.querySelectorAll('.modal-overlay');
        const modalCloseBtns = document.querySelectorAll('.modal-close');
        const addArticleBtn = document.getElementById('add-article-btn');
        const addPhotoBtn = document.getElementById('add-photo-btn');
        const articleModal = document.getElementById('article-modal');
        const photoModal = document.getElementById('photo-modal');
        const saveArticleBtn = document.getElementById('save-article');
        const savePhotoBtn = document.getElementById('save-photo');
        
        // 退出登录相关
        const logoutBtns = document.querySelectorAll('#header-logout');

        // 侧边栏切换
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            const icon = sidebarToggle.querySelector('i');
            if (sidebar.classList.contains('collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        });

        // 移动端侧边栏切换
        mobileToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
        });

        // 用户菜单切换
        userMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('show');
        });

        // 点击其他区域关闭下拉菜单
        document.addEventListener('click', () => {
            userDropdown.classList.remove('show');
        });

        // 页面切换
        menuLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                const pageId = link.getAttribute('data-page');
                if (!pageId) return;
                
                // 更新菜单激活状态
                menuLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                // 更新页面内容
                pageContents.forEach(page => page.classList.remove('active'));
                document.getElementById(`${pageId}-page`).classList.add('active');
                
                // 更新页面标题
                pageTitle.textContent = link.querySelector('span').textContent;
                
                // 移动端关闭侧边栏
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('show');
                }
                
                // 关闭下拉菜单
                userDropdown.classList.remove('show');
            });
        });

        // 模态框控制
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const modalId = btn.getAttribute('data-modal');
                if (modalId) {
                    document.getElementById(modalId).classList.remove('show');
                }
            });
        });

        // 打开添加文章模态框
        addArticleBtn.addEventListener('click', () => {
            articleModal.classList.add('show');
        });

        // 打开添加照片模态框
        addPhotoBtn.addEventListener('click', () => {
            photoModal.classList.add('show');
        });

        // 保存文章
        saveArticleBtn.addEventListener('click', () => {
            // 模拟保存操作
            articleModal.classList.remove('show');
            alert('文章保存成功！');
        });

        // 保存照片
        savePhotoBtn.addEventListener('click', () => {
            // 模拟保存操作
            photoModal.classList.remove('show');
            alert('照片保存成功！');
        });

        // 点击模态框外部关闭
        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });

        // 退出登录
        logoutBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('确定要退出登录吗？')) {
                    // 使用AdminCommon的静态方法退出登录
                    AdminCommon.logout();
                }
            });
        });

        // 系统设置表单提交
        document.getElementById('settings-form').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('设置保存成功！');
        });

        // 初始化检查
        function initApp() {
            // 模拟核心库加载检查
            setTimeout(() => {
                // 模拟加载失败
                // initError.style.display = 'block';
                
                // 加载成功，加载仪表盘数据
                loadDashboardData();
            }, 1000);
        }

        // 加载仪表盘数据
        function loadDashboardData() {
            // 模拟数据加载
            const articles = [
                { id: 1, title: 'JavaScript 高级特性详解', date: '2023-06-15', views: 1243 },
                { id: 2, title: 'CSS Grid 布局完全指南', date: '2023-06-10', views: 956 },
                { id: 3, title: 'React 性能优化技巧', date: '2023-06-05', views: 1567 }
            ];

            const messages = [
                { id: 1, name: '张三', content: '文章写得很棒，受益匪浅！', date: '2023-06-16', status: 'unread' },
                { id: 2, name: '李四', content: '请问这个问题怎么解决？', date: '2023-06-14', status: 'read' }
            ];

            // 更新统计数据
            document.getElementById('articles-count').textContent = articles.length;
            document.getElementById('photos-count').textContent = '12';
            document.getElementById('messages-count').textContent = messages.length;
            document.getElementById('views-count').textContent = '3766';

            // 更新最新文章列表
            const articlesList = document.getElementById('recent-articles');
            articlesList.innerHTML = '';
            articles.forEach(article => {
                const li = document.createElement('li');
                li.className = 'recent-item';
                li.innerHTML = `
                    <div class="recent-item-header">
                        <span class="recent-item-title">${article.title}</span>
                        <span class="recent-item-date">${article.date}</span>
                    </div>
                    <div class="recent-item-content">
                        浏览量: ${article.views}
                    </div>
                `;
                articlesList.appendChild(li);
            });

            // 更新最新留言列表
            const messagesList = document.getElementById('recent-messages');
            messagesList.innerHTML = '';
            messages.forEach(message => {
                const li = document.createElement('li');
                li.className = 'recent-item';
                li.innerHTML = `
                    <div class="recent-item-header">
                        <span class="recent-item-title">${message.name}</span>
                        <span class="recent-item-date">${message.date}</span>
                    </div>
                    <div class="recent-item-content">
                        ${message.content}
                    </div>
                `;
                messagesList.appendChild(li);
            });
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化AdminCommon实例
            adminCommon.init();
            
            // 添加主题切换按钮的直接事件监听
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    // 直接从localStorage获取当前主题
                    const currentTheme = localStorage.getItem('adminTheme') || 'light';
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    
                    // 更新body类
                    if (newTheme === 'dark') {
                        document.body.classList.add('dark-theme');
                    } else {
                        document.body.classList.remove('dark-theme');
                    }
                    
                    // 更新localStorage
                    localStorage.setItem('adminTheme', newTheme);
                    
                    // 更新主题切换按钮图标
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                    }
                });
            }
            
            // 初始化应用
            initApp();
        });
        
        // 添加窗口大小变化监听，优化响应式体验
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                sidebar.classList.remove('show');
            }
        });
    </script>
</body>
</html>