<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZhouYou | 相册</title>
    <meta name="description" content="记录生活中的美好瞬间">
    <meta name="keywords" content="ZhouYou,相册,生活,摄影,瞬间">
    <link rel="icon" href="./static/img/favicon.ico" type="image/x-icon">
    <!-- 外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: {
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            700: '#374151',
                            800: '#1F2937',
                            900: '#111827',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        title: ['"Noto Serif SC"', 'serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.25); }
            .backdrop-blur {
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
            .scrollbar-hide {
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;
            }
            .scrollbar-hide::-webkit-scrollbar,
            .scrollbar-hide::-webkit-scrollbar-thumb,
            .scrollbar-hide::-webkit-scrollbar-track,
            .scrollbar-hide::-webkit-scrollbar-button,
            .scrollbar-hide::-webkit-scrollbar-corner,
            .scrollbar-hide::-webkit-scrollbar-resizer {
                width: 0 !important;
                height: 0 !important;
                display: none !important;
                background: transparent !important;
            }
            .photo-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.5rem;
            }
            .photo-zoom {
                transition: transform 0.4s ease;
            }
            .photo-zoom:hover {
                transform: scale(1.02);
            }
        }
    </style>
    
    <style>
        /* 基础样式 */
        html {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        html::-webkit-scrollbar,
        html::-webkit-scrollbar-track,
        html::-webkit-scrollbar-thumb,
        html::-webkit-scrollbar-button,
        html::-webkit-scrollbar-corner,
        html::-webkit-scrollbar-resizer {
            display: none;
            background: transparent;
        }
        
        [id] { scroll-margin-top: 80px; }
        
        /* 动画定义 - 已移至style.css */
        
        /* 相册特有样式 */
        .photo-card {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .photo-card:nth-child(2n) { animation-delay: 0.1s; }
        .photo-card:nth-child(3n) { animation-delay: 0.2s; }
        .photo-card:nth-child(4n) { animation-delay: 0.3s; }
        
        .comment-item {
            animation: slideUp 0.3s ease forwards;
        }
        
        .image-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 60%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .photo-container:hover .image-overlay {
            opacity: 1;
        }
        
        /* 模态框样式 - 已移至style.css */
        
        /* 删除确认对话框样式 */
        #delete-modal .modal-content {
            animation: modalFadeIn 0.3s ease-out;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        #delete-modal.show .modal-content {
            transform: scale(1);
        }
        
        /* 深色模式样式 */
        .dark .modal-content {
            background: #1f2937;
            color: #f9fafb;
        }
        
        .dark .close-modal {
            color: #f9fafb;
        }
        
        /* 背景轮换样式 */
        .bg-slider {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .bg-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        
        .bg-slide.active {
            opacity: 1;
        }
        
        /* 搜索栏悬浮效果样式 */
        #search-container {
            transition: all 0.3s ease-in-out;
        }
        
        #search-box {
            position: relative;
            background: white;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease-in-out;
        }
        
        .dark #search-box {
            background: #1f2937;
        }
        
        #search-container:hover #search-box,
        #search-container.search-active #search-box {
            width: 220px;
            padding-right: 8px;
        }
        
        #search-container:hover #search-input,
        #search-container.search-active #search-input {
            width: 160px;
            padding-left: 8px;
            padding-right: 8px;
        }
        
        #search-container:hover #search-clear,
        #search-container.search-active #search-clear {
            opacity: 1;
            pointer-events: auto;
        }
        
        #search-container:hover #search-toggle,
        #search-container.search-active #search-toggle {
            color: #3b82f6;
        }
        
        #search-container:not(:hover):not(.search-active) #search-box {
            width: 36px;
            height: 36px;
        }
        
        #search-container:not(:hover):not(.search-active) #search-input {
            width: 0;
            padding: 0;
            display: none;
        }
        
        #search-container:not(:hover):not(.search-active) #search-clear {
            display: none;
        }
    </style>
</head>
<body class="font-sans text-gray-800 dark:text-gray-200 bg-white dark:bg-dark-900 transition-colors duration-300">
    <!-- 背景轮换容器 -->
    <div class="bg-slider">
        <div class="bg-slide active" style="background-image: url('./static/img/background/background.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background1.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background2.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background3.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background4.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background5.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background6.jpg');"></div>
        <div class="bg-slide" style="background-image: url('./static/img/background/background7.jpg');"></div>
    </div>

    <!-- 内容包装器 -->
    <div class="content-wrapper min-h-screen pt-24 pb-16">
        <!-- 导航栏 -->
        <header id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-3">
            <nav class="container mx-auto px-4 flex items-center justify-between bg-white/80 dark:bg-dark-900/80 rounded-b-xl shadow-sm transition-all duration-300">
                <!-- Logo区域 -->
                <a href="../index.html" class="flex items-center gap-2 text-xl font-bold gradient-text">
                    <span>ZhouYou</span>
                </a>
                
                <!-- 导航链接 - 桌面端 -->
                <div class="hidden md:flex items-center space-x-1 bg-white/90 dark:bg-dark-800/90 px-3 py-2 rounded-full shadow-sm">
                    <div class="relative group">
                        <a href="#" class="px-3 py-1.5 rounded-full hover:bg-primary/10 transition-colors flex items-center gap-1 text-gray-800 dark:text-gray-100">
                            页面 <i class="fas fa-angle-down text-xs"></i>
                        </a>
                        <!-- 下拉菜单 -->
                        <div class="absolute left-0 mt-2 w-48 bg-white dark:bg-dark-800 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 transform origin-top scale-95 group-hover:scale-100">
                            <a href="../index.html" class="block px-4 py-2 hover:bg-primary/10 transition-colors text-gray-800 dark:text-gray-100">关于我</a>
                            <a href="blog.html" class="block px-4 py-2 hover:bg-primary/10 transition-colors text-gray-800 dark:text-gray-100">博客</a>
                            <a href="photo.html" class="block px-4 py-2 bg-primary/10 transition-colors text-primary font-medium">相册</a>
                            <a href="#" class="block px-4 py-2 hover:bg-primary/10 transition-colors text-gray-800 dark:text-gray-100">友链</a>
                            <a href="lyb.html" class="block px-4 py-2 hover:bg-primary/10 transition-colors text-gray-800 dark:text-gray-100">留言</a>
                        </div>
                    </div>
                </div>
                
                <!-- 右侧功能按钮 -->
                <div class="flex items-center gap-3">
                    <!-- 搜索框 - 悬浮展开效果 -->
                    <div id="search-container" class="relative">
                        <div id="search-box" class="flex items-center overflow-hidden transition-all duration-300 ease-in-out">
                            <button id="search-toggle" class="w-9 h-9 rounded-full flex items-center justify-center transition-colors" aria-label="搜索">
                                <i class="fas fa-search text-gray-600 dark:text-gray-300"></i>
                            </button>
                            <input type="text" id="search-input" placeholder="搜索照片..." class="w-0 px-0 py-1.5 bg-transparent text-sm focus:outline-none transition-all duration-300 ease-in-out">
                            <button id="search-clear" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 opacity-0 pointer-events-none transition-all duration-200">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </div>
                    </div>
                    <button id="theme-toggle" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors" aria-label="切换主题">
                        <i class="fas fa-sun dark:hidden text-yellow-500"></i>
                        <i class="fas fa-moon hidden dark:inline text-blue-300"></i>
                    </button>
                    <a href="../admin/login.html" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors" aria-label="管理员登录">
                        <i class="far fa-user text-gray-600 dark:text-gray-300"></i>
                    </a>
                    <!-- 移动端菜单按钮 -->
                    <button id="mobile-menu-btn" class="md:hidden w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors" aria-label="菜单">
                        <i class="fas fa-bars text-gray-600 dark:text-gray-300"></i>
                    </button>
                </div>
            </nav>
            
            <!-- 移动端菜单 -->
            <div id="mobile-menu" class="md:hidden hidden bg-white dark:bg-dark-800 absolute top-full left-0 right-0 shadow-lg rounded-b-xl mt-1 p-4 animate-fadeIn">
                <div class="flex flex-col space-y-3">
                    <!-- 移动端菜单内容（与blog.html保持一致） -->
                    <div>
                        <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-primary/10 transition-colors text-gray-800 dark:text-gray-100">
                            <span>页面</span>
                            <i class="fas fa-angle-down text-xs"></i>
                        </a>
                        <div class="pl-4 mt-1 border-l-2 border-gray-200 dark:border-dark-700 space-y-2">
                            <a href="../index.html" class="block px-3 py-1.5 rounded hover:bg-primary/10 transition-colors">关于我</a>
                            <a href="blog.html" class="block px-3 py-1.5 rounded hover:bg-primary/10 transition-colors">博客</a>
                            <a href="photo.html" class="block px-3 py-1.5 rounded bg-primary/10 transition-colors text-primary font-medium">相册</a>
                            <a href="#" class="block px-3 py-1.5 rounded hover:bg-primary/10 transition-colors">友链</a>
                            <a href="lyb.html" class="block px-3 py-1.5 rounded hover:bg-primary/10 transition-colors">留言</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="container mx-auto px-4">
            <!-- 页面标题 -->
            <div class="text-center mb-10 animate-fadeIn">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-title font-bold mb-3 gradient-text">生活相册</h1>
                <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">记录生活中的美好瞬间，每一帧都是时光的礼物</p>
                
                <!-- 发布按钮 -->
                <button id="publish-btn" class="mt-6 bg-primary hover:bg-primary/90 text-white px-6 py-2.5 rounded-full shadow-md hover:shadow-lg transition-all flex items-center gap-2 mx-auto">
                    <i class="fas fa-plus"></i>
                    <span>发布新照片</span>
                </button>
            </div>
  
            <!-- 相册过滤标签 -->
            <div class="flex flex-wrap justify-center gap-2 mb-10">
                <button class="filter-btn px-4 py-1.5 rounded-full bg-primary text-white transition-colors" data-category="all">全部</button>
                <button class="filter-btn px-4 py-1.5 rounded-full bg-white/80 dark:bg-dark-800/80 hover:bg-primary/10 transition-colors" data-category="scenery">风景</button>
                <button class="filter-btn px-4 py-1.5 rounded-full bg-white/80 dark:bg-dark-800/80 hover:bg-primary/10 transition-colors" data-category="portrait">人像</button>
                <button class="filter-btn px-4 py-1.5 rounded-full bg-white/80 dark:bg-dark-800/80 hover:bg-primary/10 transition-colors" data-category="food">美食</button>
                <button class="filter-btn px-4 py-1.5 rounded-full bg-white/80 dark:bg-dark-800/80 hover:bg-primary/10 transition-colors" data-category="travel">旅行</button>
                <button class="filter-btn px-4 py-1.5 rounded-full bg-white/80 dark:bg-dark-800/80 hover:bg-primary/10 transition-colors" data-category="daily">日常</button>
            </div>

            <!-- 照片网格 -->
            <div class="photo-grid mb-16">
                <!-- 新添加的照片将显示在这里 -->
            </div>
        </main>
    </div>

    <!-- 发布照片模态框 -->
    <div id="publish-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4" style="display: none;">
        <div class="absolute inset-0 bg-black/50 backdrop-blur"></div>
        <div class="modal-content bg-white dark:bg-dark-800 rounded-2xl shadow-xl w-full max-w-md relative z-10">
            <div class="flex flex-col h-full">
                <div class="flex justify-between items-center mb-4 p-6 pb-0">
                    <h3 class="text-xl font-bold">发布新照片</h3>
                    <button class="close-modal w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body p-6 pt-2">
                    <form id="publish-form" class="space-y-4">
                        <!-- 图片上传 -->
                        <div class="border-2 border-dashed border-gray-300 dark:border-dark-700 rounded-xl p-6 text-center hover:border-primary transition-colors cursor-pointer relative" id="image-upload-area">
                            <input type="file" id="image-upload" accept="image/*" class="hidden">
                            <div id="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="text-gray-500 dark:text-gray-400">点击或拖拽图片到此处上传</p>
                                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">支持 JPG、PNG 格式，最大 10MB</p>
                            </div>
                            <div id="upload-preview" class="hidden">
                                <img id="preview-image" src="" alt="预览图" class="w-full h-48 object-cover rounded-lg mb-3">
                                <div class="flex items-center justify-between">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">
                                        <i class="fas fa-check-circle text-green-500 mr-1"></i>
                                        已导入照片
                                    </p>
                                    <button type="button" id="remove-image" class="text-red-500 hover:text-red-700 transition-colors">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 照片标题 -->
                        <div>
                            <label for="photo-title" class="block text-sm font-medium mb-1">照片标题</label>
                            <input type="text" id="photo-title" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="给照片起个名字吧">
                        </div>
                        
                        <!-- 照片描述 -->
                        <div>
                            <label for="photo-desc" class="block text-sm font-medium mb-1">照片描述</label>
                            <textarea id="photo-desc" rows="3" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="分享一下拍摄的故事..."></textarea>
                        </div>
                        
                        <!-- 照片分类 -->
                        <div>
                            <label for="photo-category" class="block text-sm font-medium mb-1">分类</label>
                            <select id="photo-category" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="scenery">风景</option>
                                <option value="portrait">人像</option>
                                <option value="food">美食</option>
                                <option value="travel">旅行</option>
                                <option value="daily">日常</option>
                                <option value="city">城市</option>
                            </select>
                        </div>
                        
                        <!-- 提交按钮 -->
                        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i>
                            <span>发布照片</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑照片模态框 -->
    <div id="edit-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4" style="display: none;">
        <div class="absolute inset-0 bg-black/50 backdrop-blur"></div>
        <div class="modal-content bg-white dark:bg-dark-800 rounded-2xl shadow-xl w-full max-w-md relative z-10">
            <div class="flex flex-col h-full">
                <div class="flex justify-between items-center mb-4 p-6 pb-0">
                    <h3 class="text-xl font-bold">编辑照片</h3>
                    <button class="close-modal w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body p-6 pt-2">
                    <form id="edit-form" class="space-y-4">
                        <input type="hidden" id="edit-photo-id">
                        
                        <!-- 当前图片预览 -->
                        <div class="rounded-xl overflow-hidden">
                            <img id="edit-photo-preview" src="" alt="预览图" class="w-full h-48 object-cover">
                        </div>
                        
                        <!-- 照片标题 -->
                        <div>
                            <label for="edit-photo-title" class="block text-sm font-medium mb-1">照片标题</label>
                            <input type="text" id="edit-photo-title" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <!-- 照片描述 -->
                        <div>
                            <label for="edit-photo-desc" class="block text-sm font-medium mb-1">照片描述</label>
                            <textarea id="edit-photo-desc" rows="3" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                        </div>
                        
                        <!-- 照片分类 -->
                        <div>
                            <label for="edit-photo-category" class="block text-sm font-medium mb-1">分类</label>
                            <select id="edit-photo-category" class="w-full px-4 py-2.5 bg-gray-100 dark:bg-dark-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="scenery">风景</option>
                                <option value="portrait">人像</option>
                                <option value="food">美食</option>
                                <option value="travel">旅行</option>
                                <option value="daily">日常</option>
                                <option value="city">城市</option>
                            </select>
                        </div>
                        
                        <!-- 提交按钮 -->
                        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                            <i class="fas fa-save"></i>
                            <span>保存修改</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="delete-modal" class="modal fixed inset-0 z-50 items-center justify-center p-4" style="display: none;">
        <div class="absolute inset-0 bg-black/50 backdrop-blur"></div>
        <div class="modal-content bg-white dark:bg-dark-800 rounded-2xl shadow-xl w-full max-w-sm relative z-10 overflow-hidden">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-2xl text-red-500"></i>
                </div>
                
                <h3 class="text-xl font-bold mb-2">确认删除？</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6" id="delete-confirm-text">您确定要删除这张照片吗？此操作不可撤销。</p>
                
                <div class="flex gap-3">
                    <button id="cancel-delete" class="flex-1 py-2.5 border border-gray-300 dark:border-dark-700 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors">
                        取消
                    </button>
                    <button id="confirm-delete" class="flex-1 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                        确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentPhotoId = null;
        let currentCommentId = null;
        
        // DOM元素缓存
        const elements = {
            navbar: document.getElementById('navbar'),
            themeToggle: document.getElementById('theme-toggle'),
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            mobileMenu: document.getElementById('mobile-menu'),
            publishBtn: document.getElementById('publish-btn'),
            publishModal: document.getElementById('publish-modal'),
            editModal: document.getElementById('edit-modal'),
            deleteModal: document.getElementById('delete-modal'),
            publishForm: document.getElementById('publish-form'),
            editForm: document.getElementById('edit-form'),
            imageUploadArea: document.getElementById('image-upload-area'),
            imageUpload: document.getElementById('image-upload'),
            uploadPlaceholder: document.getElementById('upload-placeholder'),
            uploadPreview: document.getElementById('upload-preview'),
            previewImage: document.getElementById('preview-image'),
            removeImageBtn: document.getElementById('remove-image'),
            photoGrid: document.querySelector('.photo-grid'),
            searchContainer: document.getElementById('search-container'),
            searchInput: document.getElementById('search-input'),
            searchClear: document.getElementById('search-clear'),
            searchToggle: document.getElementById('search-toggle')
        };
        
        // 初始化函数
        function init() {
            setupEventListeners();
            loadPhotosFromLocalStorage(); // 加载用户添加的照片
            initSearchFunctionality();
            initBackgroundSlider();
            updateFilterButtons('all');
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 导航栏滚动效果
            window.addEventListener('scroll', handleNavbarScroll);
            
            // 主题切换
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // 移动端菜单切换
            elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            
            // 模态框控制
            elements.publishBtn.addEventListener('click', () => openModal(elements.publishModal));
            
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            document.getElementById('cancel-delete').addEventListener('click', closeAllModals);
            
            // 点击模态框外部关闭
            [elements.publishModal, elements.editModal, elements.deleteModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) closeAllModals();
                });
            });
            
            // 图片上传
            setupImageUpload();
            
            // 表单提交
            elements.publishForm.addEventListener('submit', handlePublishSubmit);
            elements.editForm.addEventListener('submit', handleEditSubmit);
            
            // 确认删除
            document.getElementById('confirm-delete').addEventListener('click', handleConfirmDelete);
            
            // 过滤按钮
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterPhotos(category);
                    updateFilterButtons(category);
                });
            });
            
            // 窗口大小改变时重新设置模态框高度
            window.addEventListener('resize', handleWindowResize);
        }
        
        // 导航栏滚动效果
        function handleNavbarScroll() {
            if (window.scrollY > 50) {
                elements.navbar.classList.add('nav-scrolled');
            } else {
                elements.navbar.classList.remove('nav-scrolled');
            }
        }
        
        // 主题切换
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }
        
        // 检查本地存储的主题偏好
        function checkThemePreference() {
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // 移动端菜单切换
        function toggleMobileMenu() {
            elements.mobileMenu.classList.toggle('hidden');
        }
        
        // 模态框控制
        function openModal(modal) {
            modal.style.display = 'flex';
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            document.body.style.scrollbarWidth = 'none';
            document.body.style.msOverflowStyle = 'none';
            setModalHeight(modal);
        }
        
        function closeAllModals() {
            [elements.publishModal, elements.editModal, elements.deleteModal].forEach(modal => {
                modal.style.display = 'none';
                modal.classList.remove('show');
            });
            document.body.style.overflow = '';
            document.body.style.scrollbarWidth = 'none';
            document.body.style.msOverflowStyle = 'none';
            currentPhotoId = null;
            currentCommentId = null;
        }
        
        // 设置模态框高度和滚动
        function setModalHeight(modal) {
            const modalContent = modal.querySelector('.modal-content');
            const modalBody = modal.querySelector('.modal-body');
            
            // 重置高度
            modalContent.style.maxHeight = '';
            modalBody.style.maxHeight = '';
            
            // 延迟执行以确保DOM已更新
            setTimeout(() => {
                // 设置模态框内容最大高度为视口高度的90%
                const viewportHeight = window.innerHeight;
                const maxHeight = viewportHeight * 0.9;
                modalContent.style.maxHeight = `${maxHeight}px`;
                
                // 计算头部高度
                const header = modal.querySelector('.flex.justify-between');
                const headerHeight = header ? header.offsetHeight : 0;
                
                // 设置主体区域高度，确保只有modal-body有滚动条
                const bodyMaxHeight = maxHeight - headerHeight - 32; // 32px为padding
                modalBody.style.maxHeight = `${bodyMaxHeight}px`;
                modalBody.style.overflowY = 'auto';
            }, 10);
        }
        
        // 窗口大小改变时重新设置模态框高度
        function handleWindowResize() {
            if (elements.publishModal.style.display === 'flex') {
                setModalHeight(elements.publishModal);
            }
            if (elements.editModal.style.display === 'flex') {
                setModalHeight(elements.editModal);
            }
        }
        
        // 图片上传功能
        function setupImageUpload() {
            // 点击上传区域
            elements.imageUploadArea.addEventListener('click', () => {
                elements.imageUpload.click();
            });
            
            // 文件选择后显示预览
            elements.imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    displayImagePreview(file);
                }
            });
            
            // 移除图片
            elements.removeImageBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // 防止触发上传区域的点击事件
                elements.imageUpload.value = '';
                elements.uploadPreview.classList.add('hidden');
                elements.uploadPlaceholder.classList.remove('hidden');
            });
            
            // 拖拽上传
            elements.imageUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.imageUploadArea.classList.add('border-primary');
            });
            
            elements.imageUploadArea.addEventListener('dragleave', () => {
                elements.imageUploadArea.classList.remove('border-primary');
            });
            
            elements.imageUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.imageUploadArea.classList.remove('border-primary');
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    elements.imageUpload.files = e.dataTransfer.files;
                    displayImagePreview(file);
                }
            });
        }
        
        // 显示图片预览
        function displayImagePreview(file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    elements.previewImage.src = e.target.result;
                    elements.uploadPlaceholder.classList.add('hidden');
                    elements.uploadPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // 发布照片表单提交
        function handlePublishSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('photo-title').value;
            const desc = document.getElementById('photo-desc').value;
            const category = document.getElementById('photo-category').value;
            const categoryText = document.getElementById('photo-category').options[document.getElementById('photo-category').selectedIndex].text;
            
            if (title && elements.imageUpload.files.length) {
                // 创建照片对象
                const photoData = {
                    id: Date.now(), // 用时间戳作为ID
                    title: title,
                    description: desc,
                    category: category,
                    categoryText: categoryText,
                    date: new Date().toLocaleDateString(),
                    comments: [],
                    isLocal: true // 标记为本地添加的照片
                };
                
                // 读取图片文件并转换为Base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoData.imageSrc = e.target.result; // 保存Base64图片数据
                    
                    // 保存到localStorage
                    savePhotoToLocalStorage(photoData);
                    
                    // 创建照片卡片并添加到页面
                    addPhotoCardToPage(photoData);
                    
                    // 重置表单
                    elements.publishForm.reset();
                    elements.uploadPreview.classList.add('hidden');
                    elements.uploadPlaceholder.classList.remove('hidden');
                    
                    // 关闭模态框
                    closeAllModals();
                };
                reader.readAsDataURL(elements.imageUpload.files[0]);
            }
        }
        
        // 编辑照片表单提交
        function handleEditSubmit(e) {
            e.preventDefault();
            
            const photoId = document.getElementById('edit-photo-id').value;
            const title = document.getElementById('edit-photo-title').value;
            const desc = document.getElementById('edit-photo-desc').value;
            const category = document.getElementById('edit-photo-category').value;
            const categoryText = document.getElementById('edit-photo-category').options[document.getElementById('edit-photo-category').selectedIndex].text;
            
            if (photoId && title) {
                // 检查是否是原始照片（ID以"initial-"开头）
                if (photoId.startsWith('initial-')) {
                    // 原始照片，直接更新DOM
                    const photoCard = document.querySelector(`.photo-card[data-photo-id="${photoId}"]`) || 
                                     document.querySelector(`.edit-photo[data-id="${photoId}"]`).closest('.photo-card');
                    
                    if (photoCard) {
                        // 更新照片信息
                        photoCard.querySelector('h3').textContent = title;
                        photoCard.querySelector('p').textContent = desc;
                        photoCard.querySelector('.image-overlay .bg-primary\\/80').textContent = categoryText;
                        
                        // 更新data-category属性
                        photoCard.setAttribute('data-category', category);
                        
                        // 如果需要更新图片，也可以在这里处理
                        const previewSrc = document.getElementById('edit-photo-preview').src;
                        if (previewSrc && !previewSrc.includes('data:image')) {
                            photoCard.querySelector('img').src = previewSrc;
                        }
                    }
                } else {
                    // 用户添加的照片，更新localStorage
                    updatePhotoInLocalStorage(photoId, (photo) => {
                        photo.title = title;
                        photo.description = desc;
                        photo.category = category;
                        photo.categoryText = categoryText;
                        return photo;
                    });
                    
                    // 更新UI上的照片卡片信息
                    const photoCard = document.querySelector(`.photo-card[data-photo-id="${photoId}"]`);
                    if (photoCard) {
                        photoCard.querySelector('h3').textContent = title;
                        photoCard.querySelector('p').textContent = desc;
                        photoCard.querySelector('.image-overlay .bg-primary\\/80').textContent = categoryText;
                        // 更新data-category属性
                        photoCard.setAttribute('data-category', category);
                    }
                }
                
                closeAllModals();
            }
        }
        
        // 确认删除
        function handleConfirmDelete() {
            try {
                if (currentPhotoId) {
                    // 确保photoId是字符串类型
                    const photoId = String(currentPhotoId);
                    
                    // 检查是否是原始照片（ID以"initial-"开头）
                    if (photoId.startsWith('initial-')) {
                        // 原始照片，直接从DOM删除
                        const photoCard = document.querySelector(`.photo-card[data-photo-id="${photoId}"]`) || 
                                         document.querySelector(`.edit-photo[data-id="${photoId}"]`).closest('.photo-card');
                        
                        if (photoCard) {
                            removePhotoCard(photoCard);
                        } else {
                            closeAllModals();
                        }
                    } else {
                        // 用户添加的照片，从localStorage删除
                        let photoCard = document.querySelector(`.photo-card[data-photo-id="${photoId}"]`);
                        
                        if (photoCard) {
                            // 从localStorage删除照片数据
                            deletePhotoFromLocalStorage(photoId);
                            
                            // 删除UI元素
                            removePhotoCard(photoCard);
                        } else {
                            closeAllModals();
                        }
                    }
                } else if (currentCommentId) {
                    // 删除评论逻辑
                    const deleteBtn = document.querySelector(`.delete-comment[data-comment-id="${currentCommentId}"]`);
                    if (deleteBtn) {
                        const item = deleteBtn.closest('.comment-item');
                        if (item) {
                            // 获取照片ID
                            const photoId = String(currentCommentId.split('-')[0]);
                            let commentCount = 0;
                            
                            // 检查是否是原始照片
                            if (photoId.startsWith('initial-')) {
                                // 原始照片的评论，直接从DOM删除，不更新localStorage
                                const commentList = item.closest('.comment-list');
                                if (commentList) {
                                    commentCount = commentList.children.length - 1; // 减去即将删除的评论
                                }
                            } else {
                                // 用户添加的照片，从localStorage删除评论
                                updatePhotoInLocalStorage(photoId, (photo) => {
                                    photo.comments = photo.comments.filter(comment => comment.id !== currentCommentId);
                                    commentCount = photo.comments.length;
                                    return photo;
                                });
                            }
                            
                            // 更新UI
                            item.style.opacity = '0';
                            setTimeout(() => {
                                item.remove();
                                // 更新评论计数
                                const photoCard = item.closest('.photo-card');
                                if (photoCard) {
                                    photoCard.querySelector('.fa-comment').parentElement.textContent = `${commentCount}条评论`;
                                }
                                
                                currentCommentId = null;
                                closeAllModals();
                            }, 300);
                        } else {
                            currentCommentId = null;
                            closeAllModals();
                        }
                    } else {
                        currentCommentId = null;
                        closeAllModals();
                    }
                } else {
                    closeAllModals();
                }
            } catch (error) {
                console.error('删除操作出错:', error);
                currentPhotoId = null;
                currentCommentId = null;
                closeAllModals();
            }
        }
        
        // 删除照片卡片
        function removePhotoCard(photoCard) {
            photoCard.style.opacity = '0';
            photoCard.style.transform = 'translateY(20px)';
            photoCard.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            setTimeout(() => {
                photoCard.remove();
                currentPhotoId = null;
                closeAllModals();
            }, 300);
        }
        
        // 打开编辑模态框
        function openEditModal(photoId) {
            // 确保photoId是字符串类型
            const photoIdStr = String(photoId);
            currentPhotoId = photoIdStr; // 设置当前照片ID
            
            // 尝试从localStorage获取照片数据
            let photos = JSON.parse(localStorage.getItem('userPhotos') || '[]');
            const photoData = photos.find(photo => String(photo.id) == photoIdStr);
            
            if (photoData) {
                // 如果是本地存储的照片，使用存储的数据
                document.getElementById('edit-photo-id').value = photoIdStr;
                document.getElementById('edit-photo-preview').src = photoData.imageSrc;
                document.getElementById('edit-photo-title').value = photoData.title;
                document.getElementById('edit-photo-desc').value = photoData.description;
                document.getElementById('edit-photo-category').value = photoData.category;
            } else {
                // 如果是原始照片，使用原有的方式
                const photoCard = document.querySelector(`.photo-card[data-photo-id="${photoIdStr}"]`) || 
                                 document.querySelector(`.edit-photo[data-id="${photoIdStr}"]`).closest('.photo-card');
                
                if (photoCard) {
                    document.getElementById('edit-photo-id').value = photoIdStr;
                    document.getElementById('edit-photo-preview').src = photoCard.querySelector('img').src;
                    document.getElementById('edit-photo-title').value = photoCard.querySelector('h3').textContent;
                    document.getElementById('edit-photo-desc').value = photoCard.querySelector('p').textContent;
                    
                    // 获取类别值
                    const categoryText = photoCard.querySelector('.image-overlay .bg-primary\\/80').textContent;
                    const categorySelect = document.getElementById('edit-photo-category');
                    for (let i = 0; i < categorySelect.options.length; i++) {
                        if (categorySelect.options[i].text === categoryText) {
                            categorySelect.value = categorySelect.options[i].value;
                            break;
                        }
                    }
                }
            }
            
            openModal(elements.editModal);
        }
        
        // 加载原始照片
        function loadInitialPhotos() {
            // 原始照片数据已移除
            // 如需添加原始照片，请在此处定义照片数据
        }
        
        // localStorage 操作
        function savePhotoToLocalStorage(photoData) {
            // 获取现有的照片数据
            let photos = JSON.parse(localStorage.getItem('userPhotos') || '[]');
            
            // 添加新照片
            photos.unshift(photoData); // 添加到数组开头，使新照片显示在最前面
            
            // 保存回localStorage
            localStorage.setItem('userPhotos', JSON.stringify(photos));
        }
        
        function loadPhotosFromLocalStorage() {
            const photos = JSON.parse(localStorage.getItem('userPhotos') || '[]');
            
            // 添加每个本地保存的照片
            photos.forEach(photoData => {
                addPhotoCardToPage(photoData);
            });
        }
        
        function updatePhotoInLocalStorage(photoId, updateFn) {
            let photos = JSON.parse(localStorage.getItem('userPhotos') || '[]');
            const photoIdStr = String(photoId);
            const index = photos.findIndex(photo => String(photo.id) == photoIdStr);
            
            if (index !== -1) {
                photos[index] = updateFn(photos[index]);
                localStorage.setItem('userPhotos', JSON.stringify(photos));
            }
        }
        
        function deletePhotoFromLocalStorage(photoId) {
            let photos = JSON.parse(localStorage.getItem('userPhotos') || '[]');
            const photoIdStr = String(photoId);
            photos = photos.filter(photo => String(photo.id) != photoIdStr);
            localStorage.setItem('userPhotos', JSON.stringify(photos));
        }
        
        // 添加照片卡片到页面
        function addPhotoCardToPage(photoData) {
            // 确保photoData.id是字符串类型
            const photoId = String(photoData.id);
            
            const newPhotoCard = document.createElement('div');
            newPhotoCard.className = 'photo-card bg-white dark:bg-dark-800 rounded-xl shadow-md overflow-hidden hover-lift opacity-0';
            newPhotoCard.setAttribute('data-photo-id', photoId);
            newPhotoCard.setAttribute('data-category', photoData.category);
            
            // 检查是否是原始照片
            const isInitialPhoto = photoId.startsWith('initial-');
            
            newPhotoCard.innerHTML = `
                <div class="photo-container relative overflow-hidden">
                    <img src="${photoData.imageSrc}" alt="${photoData.title}" class="w-full h-64 object-cover photo-zoom">
                    <div class="image-overlay absolute inset-0 flex items-end p-4">
                        <div class="text-white w-full">
                            <div class="flex justify-between items-center">
                                <span class="text-sm bg-primary/80 px-2 py-0.5 rounded">${photoData.categoryText}</span>
                                <div class="flex gap-2">
                                    <button class="edit-photo w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors" data-id="${photoId}">
                                        <i class="fas fa-edit text-sm"></i>
                                    </button>
                                    <button class="delete-photo w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors" data-id="${photoId}">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold mb-2">${photoData.title}</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-3">${photoData.description}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-500 mb-3">
                        <span>${photoData.date}</span>
                        <span><i class="far fa-comment mr-1"></i> ${photoData.comments.length}条评论</span>
                    </div>
                    
                    <!-- 评论区 -->
                    <div class="comments-section border-t dark:border-dark-700 pt-3">
                        <div class="comment-list space-y-2 max-h-40 overflow-y-auto scrollbar-hide mb-3">
                            ${photoData.comments.map(comment => `
                                <div class="comment-item bg-gray-50 dark:bg-dark-700/50 p-2 rounded-lg text-sm">
                                    <div class="flex justify-between">
                                        <span class="font-medium">${comment.author}</span>
                                        <button class="delete-comment text-gray-400 hover:text-red-500" data-comment-id="${comment.id}">
                                            <i class="fas fa-times text-xs"></i>
                                        </button>
                                    </div>
                                    <p class="mt-1">${comment.text}</p>
                                    <p class="text-xs text-gray-500 mt-1">${comment.date}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="comment-input flex gap-2">
                            <input type="text" placeholder="添加评论..." class="flex-1 px-3 py-2 bg-gray-100 dark:bg-dark-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                            <button class="submit-comment bg-primary/10 hover:bg-primary/20 text-primary p-2 rounded-lg transition-colors" data-photo-id="${photoId}">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到网格最前面
            elements.photoGrid.prepend(newPhotoCard);
            
            // 触发动画
            setTimeout(() => {
                newPhotoCard.style.opacity = '1';
            }, 10);
            
            // 为新卡片添加事件监听
            setupPhotoCardEvents(newPhotoCard, photoData, photoId, isInitialPhoto);
        }
        
        // 设置照片卡片的事件监听
        function setupPhotoCardEvents(photoCard, photoData, photoId, isInitialPhoto = false) {
            // 编辑按钮事件
            photoCard.querySelector('.edit-photo').addEventListener('click', function() {
                currentPhotoId = this.getAttribute('data-id');
                openEditModal(currentPhotoId);
            });
            
            // 删除按钮事件
            photoCard.querySelector('.delete-photo').addEventListener('click', function() {
                currentPhotoId = this.getAttribute('data-id');
                document.getElementById('delete-confirm-text').textContent = '您确定要删除这张照片吗？此操作不可撤销。';
                openModal(elements.deleteModal);
            });
            
            // 提交评论事件
            photoCard.querySelector('.submit-comment').addEventListener('click', function() {
                const commentInput = this.parentElement.querySelector('input');
                const commentText = commentInput.value.trim();
                
                if (commentText) {
                    // 创建新评论对象
                    const newComment = {
                        id: `${photoId}-${Date.now()}`,
                        author: '访客',
                        text: commentText,
                        date: '刚刚'
                    };
                    
                    // 只有非原始照片才更新localStorage
                    if (!isInitialPhoto) {
                        // 更新数据
                        updatePhotoInLocalStorage(photoId, (photo) => {
                            photo.comments.unshift(newComment);
                            return photo;
                        });
                    }
                    
                    // 添加评论到UI
                    const commentList = this.closest('.comments-section').querySelector('.comment-list');
                    const newCommentElement = document.createElement('div');
                    newCommentElement.className = 'comment-item bg-gray-50 dark:bg-dark-700/50 p-2 rounded-lg text-sm opacity-0';
                    newCommentElement.innerHTML = `
                        <div class="flex justify-between">
                            <span class="font-medium">${newComment.author}</span>
                            <button class="delete-comment text-gray-400 hover:text-red-500" data-comment-id="${newComment.id}">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </div>
                        <p class="mt-1">${newComment.text}</p>
                        <p class="text-xs text-gray-500 mt-1">${newComment.date}</p>
                    `;
                    
                    commentList.prepend(newCommentElement);
                    setTimeout(() => {
                        newCommentElement.style.opacity = '1';
                    }, 10);
                    commentInput.value = '';
                    
                    // 更新评论计数
                    const commentCount = commentList.children.length;
                    photoCard.querySelector('.fa-comment').parentElement.textContent = `${commentCount}条评论`;
                    
                    // 为新评论添加删除事件
                    newCommentElement.querySelector('.delete-comment').addEventListener('click', function() {
                        currentCommentId = this.getAttribute('data-comment-id');
                        document.getElementById('delete-confirm-text').textContent = '您确定要删除这条评论吗？';
                        openModal(elements.deleteModal);
                    });
                }
            });
            
            // 为已有评论添加删除事件
            photoCard.querySelectorAll('.delete-comment').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentCommentId = this.getAttribute('data-comment-id');
                    document.getElementById('delete-confirm-text').textContent = '您确定要删除这条评论吗？';
                    openModal(elements.deleteModal);
                });
            });
        }
        
        // 背景轮播
        function initBackgroundSlider() {
            const slides = document.querySelectorAll('.bg-slide');
            let currentSlide = 0;
            
            function showSlide(index) {
                slides.forEach(slide => slide.classList.remove('active'));
                slides[index].classList.add('active');
            }
            
            function nextSlide() {
                currentSlide = (currentSlide + 1) % slides.length;
                showSlide(currentSlide);
            }
            
            // 每10秒切换一次背景
            setInterval(nextSlide, 10000);
        }
        
        // 过滤照片功能
        function filterPhotos(category) {
            const photoCards = document.querySelectorAll('.photo-card');
            
            photoCards.forEach(card => {
                // 如果是"全部"类别，显示所有照片
                if (category === 'all') {
                    card.style.display = 'block';
                } else {
                    // 检查照片类别
                    const photoCategory = card.getAttribute('data-category');
                    if (photoCategory === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }
        
        // 更新过滤按钮的活动状态
        function updateFilterButtons(activeCategory) {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'dark:bg-dark-700', 'dark:text-gray-300');
                
                if (btn.getAttribute('data-category') === activeCategory) {
                    btn.classList.remove('bg-gray-200', 'text-gray-700', 'dark:bg-dark-700', 'dark:text-gray-300');
                    btn.classList.add('bg-primary', 'text-white');
                }
            });
        }
        
        // 搜索功能初始化
        function initSearchFunctionality() {
            let searchTimeout;
            
            // 点击搜索按钮激活搜索框
            elements.searchToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                elements.searchContainer.classList.add('search-active');
                elements.searchInput.focus();
            });
            
            // 输入时显示清除按钮
            elements.searchInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    elements.searchClear.style.opacity = '1';
                    elements.searchClear.style.pointerEvents = 'auto';
                } else {
                    elements.searchClear.style.opacity = '0';
                    elements.searchClear.style.pointerEvents = 'none';
                }
                
                // 执行搜索
                performPhotoSearch(this.value.trim());
            });
            
            // 点击清除按钮
            elements.searchClear.addEventListener('click', function(e) {
                e.stopPropagation();
                elements.searchInput.value = '';
                this.style.opacity = '0';
                this.style.pointerEvents = 'none';
                elements.searchInput.focus();
                // 重置显示所有照片
                filterPhotos('all');
            });
            
            // 按ESC键隐藏搜索框
            elements.searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    elements.searchContainer.classList.remove('search-active');
                    this.value = '';
                    elements.searchClear.style.opacity = '0';
                    elements.searchClear.style.pointerEvents = 'none';
                    filterPhotos('all');
                }
            });
            
            // 点击搜索框外部时，延迟关闭搜索框
            document.addEventListener('click', function(e) {
                if (!elements.searchContainer.contains(e.target)) {
                    // 延迟关闭，给用户时间点击清除按钮
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (!elements.searchInput.value.trim()) {
                            elements.searchContainer.classList.remove('search-active');
                        }
                    }, 200);
                }
            });
            
            // 点击搜索框内部时，取消延迟关闭
            elements.searchContainer.addEventListener('click', function(e) {
                e.stopPropagation();
                clearTimeout(searchTimeout);
            });
        }
        
        // 执行搜索功能
        function performPhotoSearch(query) {
            const photoCards = document.querySelectorAll('.photo-card');
            
            if (!query) {
                // 如果搜索框为空，显示所有照片
                photoCards.forEach(card => {
                    card.style.display = 'block';
                    removeHighlight(card);
                });
                return;
            }
            
            photoCards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                const category = card.getAttribute('data-category').toLowerCase();
                
                // 检查标题、描述或类别是否包含搜索关键词
                if (title.includes(query.toLowerCase()) || 
                    description.includes(query.toLowerCase()) || 
                    category.includes(query.toLowerCase())) {
                    card.style.display = 'block';
                    highlightPhotoText(card, query);
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // 高亮显示匹配的文本
        function highlightPhotoText(card, query) {
            // 先移除之前的高亮
            removeHighlight(card);
            
            if (!query) return;
            
            const titleElement = card.querySelector('h3');
            const descElement = card.querySelector('p');
            
            // 高亮标题
            const titleText = titleElement.textContent;
            const highlightedTitle = titleText.replace(new RegExp(`(${query})`, 'gi'), '<mark class="bg-yellow-200 dark:bg-yellow-800">$1</mark>');
            titleElement.innerHTML = highlightedTitle;
            
            // 高亮描述
            const descText = descElement.textContent;
            const highlightedDesc = descText.replace(new RegExp(`(${query})`, 'gi'), '<mark class="bg-yellow-200 dark:bg-yellow-800">$1</mark>');
            descElement.innerHTML = highlightedDesc;
        }
        
        // 移除高亮
        function removeHighlight(card) {
            const titleElement = card.querySelector('h3');
            const descElement = card.querySelector('p');
            
            // 移除标题高亮
            titleElement.innerHTML = titleElement.textContent;
            
            // 移除描述高亮
            descElement.innerHTML = descElement.textContent;
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            checkThemePreference();
            init();
        });
    </script>
</body>
</html>